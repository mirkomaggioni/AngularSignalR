{"version":3,"sources":["Controllers/OrdersController.ts"],"names":[],"mappings":"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","file":"OrdersController.js","sourcesContent":["/// <reference path=\"../../scripts/typings/angular-ui-bootstrap/angular-ui-bootstrap.d.ts\" />\r\n/// <reference path=\"../../scripts/typings/angularjs-toaster/angularjs-toaster.d.ts\" />\r\n/// <reference path=\"../../scripts/typings/angularjs/angular-resource.d.ts\" />\r\n/// <reference path=\"../models/order.ts\" />\r\n/// <reference path=\"../services/ordersservice.ts\" />\r\n/// <reference path=\"../services/notificationsservice.ts\" />\r\n/// <reference path=\"../commons.ts\" />\r\n/// <reference path=\"../app.ts\" />\r\n\r\nnamespace AngularSignalRApp.Controllers {\r\n\r\n    import ngr = ng.resource;\r\n    import constant = AngularSignalRApp.Commons.Constants;\r\n\r\n    export class OrdersController {\r\n        public orders: ngr.IResourceArray<ngr.IResource<AngularSignalRApp.Models.IOrder>>;\r\n        public order: AngularSignalRApp.Models.IOrder;\r\n        public title: string;\r\n        public toaster: ngtoaster.IToasterService;\r\n\r\n        private filter: ng.IFilterService;\r\n        private modalService: ng.ui.bootstrap.IModalService;\r\n        private ordersService: AngularSignalRApp.Services.OrdersService;\r\n        private notificationsService: AngularSignalRApp.Services.NotificationsService;\r\n        private constant: AngularSignalRApp.Commons.Constants;\r\n\r\n        constructor($filter: ng.IFilterService, $uibModal: ng.ui.bootstrap.IModalService, toaster: ngtoaster.IToasterService,\r\n                    ordersService: AngularSignalRApp.Services.OrdersService, notificationsService: AngularSignalRApp.Services.NotificationsService) {\r\n            this.filter = $filter;\r\n            this.modalService = $uibModal;\r\n            this.ordersService = ordersService;\r\n            this.notificationsService = notificationsService;\r\n            this.constant = constant;\r\n\r\n            this.notificationsService.OnOrderChanges(() => {\r\n                this.Load();\r\n            });\r\n\r\n            this.toaster = toaster;\r\n            this.title = \"Orders\";\r\n\r\n            this.Load();\r\n        }\r\n\r\n        public New() {\r\n            this.order = {\r\n                Id: constant.guidEmpty,\r\n                Article: \"\",\r\n                Amount: 0,\r\n                CreationDate: new Date(),\r\n                Customer: \"\",\r\n                Notes: \"\"\r\n            };\r\n        }\r\n\r\n        public Edit(order: AngularSignalRApp.Models.IOrder) {\r\n            this.order = order;\r\n        }\r\n\r\n        public Delete() {\r\n\r\n            let vm = this;\r\n            let modalInstance = vm.modalService.open({\r\n                animation: true,\r\n                templateUrl: \"/App/Views/Shared/ConfirmDeleteModal.html\",\r\n                controller: \"ModalsController as vm\",\r\n                size: \"modal-sm\"\r\n            });\r\n\r\n            modalInstance.result.then(function () {\r\n                vm.ordersService.delete(vm.order).$promise.then(\r\n                    (data) => {\r\n                        let orderToDelete = vm.filter(\"filter\")(vm.orders, { Id: vm.order.Id })[0];\r\n                        let index = vm.orders.indexOf(orderToDelete);\r\n                        vm.orders.splice(index, 1);\r\n                        vm.order = null;\r\n\r\n                        vm.notificationsService.NotifyOrderChanges();\r\n                        vm.toaster.success(\"Order deleted successfully.\");\r\n                    },\r\n                    (error) => {\r\n                        vm.toaster.error(\"Error deleting order.\", error.data.message);\r\n                });\r\n            });\r\n        }\r\n\r\n        public Save() {\r\n            this.ordersService.save(this.order).$promise.then(\r\n                (data: any) => {\r\n                    if (this.order.Id === constant.guidEmpty) {\r\n                        this.order = data;\r\n                        this.orders.push(data);\r\n                    }\r\n\r\n                    this.notificationsService.NotifyOrderChanges();\r\n                    this.toaster.success(\"Order saved successfully.\");\r\n\r\n                },\r\n                (error: any) => {\r\n                    this.toaster.error(\"Error saving order\", error.data.message);\r\n            });\r\n        }\r\n\r\n        public Close() {\r\n            this.order = null;\r\n        }\r\n\r\n        private Load() {\r\n            this.ordersService.getAll().$promise.then(\r\n                (data) => {\r\n                    this.orders = data;\r\n                    this.toaster.success(\"Orders loaded successfully.\");\r\n                    return;\r\n                },\r\n                (error) => {\r\n                    this.toaster.error(\"Error loading orders\", error.data.message);\r\n            });\r\n        }\r\n    }\r\n\r\n    AngularSignalR.module.controller(\"OrdersController\", OrdersController);\r\n}\r\n"]}